<!DOCTYPE html>
<html lang="en">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Artigo</title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/articles.css">
    <link rel="shortcut icon" type="image/jpg" href="/img/favicon.png"/>
</head>
<body>
    <link rel="stylesheet" href="/css/style.css">
<link rel="stylesheet" href="/css/navbar.css">

<div class="container__nav">
    <nav>
        <div style="display: flex; flex-direction: row; align-items: center; gap: 10px;">
            <img src="/img/jayp.jpg" class="avatar__navbar" alt="">
            <a href="/" class="link__navbar">
                <h1 id="title__nav">Jayp</h1>
            </a>
        </div>
        <div class="nav-links">
            <a href="/about/" class="link__navbar" title="Um breve resumo sobre mim">About</a>
            <a href="https://github.com/jayp-xgh" style="display: flex;" title="Github">
                <svg width="14" height="15" viewBox="0 0 14 15" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M4.68266 11.2169C4.68266 11.2734 4.61774 11.3185 4.53589 11.3185C4.44274 11.327 4.37782 11.2819 4.37782 11.2169C4.37782 11.1605 4.44274 11.1153 4.5246 11.1153C4.60927 11.1069 4.68266 11.152 4.68266 11.2169ZM3.80484 11.0899C3.78508 11.1464 3.84153 11.2113 3.92621 11.2282C3.9996 11.2565 4.08427 11.2282 4.10121 11.1718C4.11815 11.1153 4.06452 11.0504 3.97984 11.025C3.90645 11.0052 3.8246 11.0335 3.80484 11.0899ZM5.05242 11.0419C4.97056 11.0617 4.91411 11.1153 4.92258 11.1802C4.93105 11.2367 5.00444 11.2734 5.08911 11.2536C5.17097 11.2339 5.22742 11.1802 5.21895 11.1238C5.21048 11.0702 5.13427 11.0335 5.05242 11.0419ZM6.90968 0.225807C2.99476 0.225807 0 3.19798 0 7.1129C0 10.2431 1.97016 12.9218 4.78427 13.8645C5.14556 13.9294 5.27258 13.7065 5.27258 13.523C5.27258 13.348 5.26411 12.3827 5.26411 11.7899C5.26411 11.7899 3.28831 12.2133 2.87339 10.9488C2.87339 10.9488 2.55161 10.1274 2.08871 9.91573C2.08871 9.91573 1.44234 9.47258 2.13387 9.48105C2.13387 9.48105 2.83669 9.5375 3.22339 10.2093C3.84153 11.2988 4.87742 10.9855 5.28105 10.7992C5.34597 10.3476 5.52944 10.0343 5.73266 9.84798C4.15484 9.67298 2.5629 9.44435 2.5629 6.72903C2.5629 5.95282 2.77742 5.56331 3.22903 5.06653C3.15565 4.88306 2.91573 4.12661 3.30242 3.15C3.89234 2.96653 5.25 3.9121 5.25 3.9121C5.81452 3.75403 6.42137 3.67218 7.02258 3.67218C7.62379 3.67218 8.23065 3.75403 8.79516 3.9121C8.79516 3.9121 10.1528 2.96371 10.7427 3.15C11.1294 4.12944 10.8895 4.88306 10.8161 5.06653C11.2677 5.56613 11.5444 5.95565 11.5444 6.72903C11.5444 9.45282 9.88185 9.67016 8.30403 9.84798C8.56371 10.071 8.78387 10.4944 8.78387 11.1577C8.78387 12.1089 8.7754 13.2859 8.7754 13.5173C8.7754 13.7008 8.90524 13.9238 9.26371 13.8589C12.0863 12.9218 14 10.2431 14 7.1129C14 3.19798 10.8246 0.225807 6.90968 0.225807ZM2.74355 9.96089C2.70685 9.98911 2.71532 10.054 2.76331 10.1077C2.80847 10.1528 2.87339 10.1726 2.91008 10.1359C2.94677 10.1077 2.93831 10.0427 2.89032 9.98911C2.84516 9.94395 2.78024 9.92419 2.74355 9.96089ZM2.43871 9.73226C2.41895 9.76895 2.44718 9.81411 2.50363 9.84234C2.54879 9.87056 2.60524 9.8621 2.625 9.82258C2.64476 9.78589 2.61653 9.74073 2.56008 9.7125C2.50363 9.69556 2.45847 9.70403 2.43871 9.73226ZM3.35323 10.7371C3.30806 10.7738 3.325 10.8585 3.38992 10.9121C3.45484 10.977 3.53669 10.9855 3.57339 10.9403C3.61008 10.9036 3.59315 10.819 3.53669 10.7653C3.4746 10.7004 3.38992 10.6919 3.35323 10.7371ZM3.03145 10.3222C2.98629 10.3504 2.98629 10.4238 3.03145 10.4887C3.07661 10.5536 3.15282 10.5819 3.18952 10.5536C3.23468 10.5169 3.23468 10.4435 3.18952 10.3786C3.15 10.3137 3.07661 10.2855 3.03145 10.3222Z" fill="black"/>
                </svg>
            </a>
            <a href="https://www.linkedin.com/in/joao-pereira-7736b320b/" class="link__navbar lk" title="Linkedin">
                lk
            </a>
            <a href="https://twitter.com/jayp_xgh" style="display: flex; align-items: center; gap: 5px;" class="link__navbar tt" title="Twitter">
               tt
            </a>
            <a href="https://www.youtube.com/@jayp-xgh/videos" class="link__navbar yt" title="Canal do Youtube">
                yt
            </a>
        </div>
    </nav>
</div>
    <div id="container__article">
        <h2 id="bora-configurar-o-xdebug">Bora configurar o Xdebug</h2>
<span id="span__name_date">
  @jayp | Março 21, 2024
</span>

<p><img src="/img/xdebug.webp" alt="Postgres vs Mongo"></p>
<blockquote>
<p>Nunca vi um tutorial simples ensinando a configurar o Xdebug com Docker e Direnv. Neste mini tutorial, vou tentar dar o meu máximo para esclarecer e ensiná-los. Lembrando que este não é um tutorial para explicar o que é o Xdebug ou como utilizá-lo, mas sim para instalá-lo. Para isso, você pode ler a <a href="https://xdebug.org/docs/">documentação</a> ou assistir a este vídeo do <a href="https://www.youtube.com/watch?v=pi8-_hEIWJc"><strong>YouTube</strong></a>.</p>
</blockquote>
<h3 id="primeiro-vamos-configurar-o-direnvhttpsdirenvnet">Primeiro, vamos configurar o <a href="https://direnv.net/"><strong>direnv</strong></a>.</h3>
<p>Instalação:</p>
<div class="highlight"><pre tabindex="0" style="color:#cad3f5;background-color:#24273a;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    sudo apt install direnv
</span></span><span style="display:flex;"><span>   
</span></span></code></pre></div><p>Para configurar o terminal, adicione a linha abaixo ao arquivo <strong>.zshrc</strong>. Assim, sempre que você acessar uma pasta contendo um arquivo <strong>.envrc</strong>, o Direnv será ativado automaticamente.</p>
<div class="highlight"><pre tabindex="0" style="color:#cad3f5;background-color:#24273a;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#91d7e3">eval</span> <span style="color:#a6da95">&#34;</span><span style="color:#c6a0f6">$(</span>direnv hook zsh<span style="color:#c6a0f6">)</span><span style="color:#a6da95">&#34;</span>
</span></span><span style="display:flex;"><span>   
</span></span></code></pre></div><p>Agora, vamos criar o arquivo .envrc com o seguinte conteúdo na raiz do seu projeto:</p>
<div id="warning">
    <strong>Alerta:</strong> Com essa implementação, o comando <strong><a href="https://man7.org/linux/man-pages/man1/hostname.1.html">hostname</a></strong> sempre retornará o IP mais recente do seu computador.
</div>
<div class="highlight"><pre tabindex="0" style="color:#cad3f5;background-color:#24273a;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6e738d;font-style:italic">#!/usr/bin/env bash</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#91d7e3">export</span> <span style="color:#f4dbd6">DOCKER_HOST_IP</span><span style="color:#91d7e3;font-weight:bold">=</span><span style="color:#c6a0f6">$(</span>hostname -I | awk <span style="color:#a6da95">&#39;{print $1}&#39;</span><span style="color:#c6a0f6">)</span>
</span></span><span style="display:flex;"><span>   
</span></span></code></pre></div><blockquote>
<p>Na primeira vez que você acessar a pasta pelo terminal, será necessário executar o comando abaixo para permitir que o Direnv leia o arquivo <strong>.envrc</strong></p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#cad3f5;background-color:#24273a;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    direnv allow
</span></span><span style="display:flex;"><span>   
</span></span></code></pre></div><p>No seu arquivo <strong>Dockerfile</strong>, é necessário habilitar o Xdebug, lembrando que o Xdebug é um <strong>módulo</strong> do PHP, então ele fica dentro do seu <strong>php.ini</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#cad3f5;background-color:#24273a;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-dockerfile" data-lang="dockerfile"><span style="display:flex;"><span><span style="color:#ed8796">
</span></span></span><span style="display:flex;"><span><span style="color:#ed8796"></span>    <span style="color:#6e738d;font-style:italic"># Instalar e habilitar extensões PECL e Xdebug</span><span style="color:#ed8796">
</span></span></span><span style="display:flex;"><span><span style="color:#ed8796"></span>    RUN pecl install  -o -f xdebug-3.1.5 <span style="color:#8aadf4">\
</span></span></span><span style="display:flex;"><span><span style="color:#8aadf4"></span>    <span style="color:#91d7e3;font-weight:bold">&amp;&amp;</span> docker-php-ext-enable  xdebug<span style="color:#ed8796">
</span></span></span><span style="display:flex;"><span><span style="color:#ed8796"></span>   <span style="color:#ed8796">
</span></span></span></code></pre></div><p>Ainda no <strong>Dockerfile</strong>, precisamos configurar o <strong>php.ini</strong>. Não vamos entrar manualmente no container para alterá-lo.</p>
<div id="warning">
    <strong>Alerta:</strong>Lembre-se de colocar o caminho correto do **php.ini** localizado dentro do container. No exemplo, estou usando o php-custom.ini que está no seguinte caminho:
</div>
<div class="highlight"><pre tabindex="0" style="color:#cad3f5;background-color:#24273a;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-dockerfile" data-lang="dockerfile"><span style="display:flex;"><span><span style="color:#ed8796">
</span></span></span><span style="display:flex;"><span><span style="color:#ed8796"></span>    COPY ./docker/php.ini /usr/local/etc/php/conf.d/php-custom.ini<span style="color:#ed8796">
</span></span></span><span style="display:flex;"><span><span style="color:#ed8796"></span>   <span style="color:#ed8796">
</span></span></span></code></pre></div><p>Na raiz do seu projeto, crie uma pasta chamada docker e dentro dela um arquivo <strong>php.ini</strong>, Adicione a seguinte linha ao arquivo:</p>
<div class="highlight"><pre tabindex="0" style="color:#cad3f5;background-color:#24273a;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ini" data-lang="ini"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8aadf4">xdebug.mode</span> <span style="color:#91d7e3;font-weight:bold">=</span> <span style="color:#a6da95">develop,debug
</span></span></span><span style="display:flex;"><span><span style="color:#a6da95">   </span>
</span></span></code></pre></div><blockquote>
<p>Neste exemplo, estou usando o PHP 7.3, o que implica que o Xdebug está na versão 3.1.5. Para verificar as versões compatíveis com o PHP, acesse este <a href="https://xdebug.org/docs/compat"><strong>link</strong></a>.</p>
</blockquote>
<p>No <strong>docker-compose.yml</strong>, adicione um bloco <a href="https://docs.docker.com/compose/environment-variables/set-environment-variables/"><strong>environment</strong></a> dentro do serviço do seu container que contenha o PHP.</p>
<div class="highlight"><pre tabindex="0" style="color:#cad3f5;background-color:#24273a;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yml" data-lang="yml"><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#c6a0f6">environment</span>:
</span></span><span style="display:flex;"><span>    - XDEBUG_CONFIG=client_host=${DOCKER_HOST_IP:-}
</span></span><span style="display:flex;"><span>    
</span></span></code></pre></div><blockquote>
<p>Essa configuração define o endereço IP do cliente para o Xdebug no ambiente Docker. Nesse caso, o cliente é a sua máquina de desenvolvimento.</p>
</blockquote>
<h3 id="configurando-a-extensão-do-vscode">Configurando a extensão do VsCode:</h3>
<p>Instale a extensão que permitirá a depuração do código: <a href="https://marketplace.visualstudio.com/items?itemName=xdebug.php-debug"><strong>PHP Debug</strong></a></p>
<p>Após a instalação, abra o arquivo <strong>launch.json</strong>, apague todo o conteúdo e deixe apenas o seguinte script:</p>
<div id="warning">
    <strong>Alerta:</strong> O pathMappings é o local onde está o seu projeto dentro do container.
</div>
<div class="highlight"><pre tabindex="0" style="color:#cad3f5;background-color:#24273a;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#c6a0f6">&#34;version&#34;</span>: <span style="color:#a6da95">&#34;0.2.0&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#c6a0f6">&#34;configurations&#34;</span>: [
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                <span style="color:#c6a0f6">&#34;name&#34;</span>: <span style="color:#a6da95">&#34;Listen for Xdebug&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#c6a0f6">&#34;type&#34;</span>: <span style="color:#a6da95">&#34;php&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#c6a0f6">&#34;request&#34;</span>: <span style="color:#a6da95">&#34;launch&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#c6a0f6">&#34;port&#34;</span>: <span style="color:#f5a97f">9003</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#c6a0f6">&#34;pathMappings&#34;</span>: {
</span></span><span style="display:flex;"><span>                    <span style="color:#c6a0f6">&#34;/var/www/html&#34;</span>: <span style="color:#a6da95">&#34;${pathMappings}&#34;</span>
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        ]
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>   
</span></span></code></pre></div><p>Para rodar começar a utilizar o Xdebug, coloque o <strong>breakpoint</strong> no local que deseja que o código pare, de preferencia para testar, coloque ele em um arquivo de conexão com o banco de dados, só para teste, deps rretire e coloque aonde desejar. Agora  basta apertar no play locazilado em algum lugar do seu vscode com a opção &ldquo;Listen For Debug¨ ou <em>ctrl + shift + p</em>, e pesquise por <strong>Debug (PHP) Start Listening for Xdebug</strong>.</p>
<p>Agora vamos inicializar na web, em sua URL basta passar o seguinte parametro:</p>
<div class="highlight"><pre tabindex="0" style="color:#cad3f5;background-color:#24273a;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    ?XDEBUG_SESSION_START<span style="color:#91d7e3;font-weight:bold">=</span><span style="color:#91d7e3">true</span>
</span></span><span style="display:flex;"><span>   
</span></span></code></pre></div><p>vai ficar algo como: <a href="http://127.0.0.1/dashboard?XDEBUG_SESSION_START=true">http://127.0.0.1/dashboard?XDEBUG_SESSION_START=true</a></p>
<p>Após iniciar a sessão, não precisa mais passar esse parametro até que a sessão seja encerrada.</p>

    </div>
    <link rel="stylesheet" href="/css/style.css">
<footer>
    <span class="span__fonte">João Pereira
       <a href="https://twitter.com/jayp_xgh">
           (@jayp)
       </a>
    </span>
    <span class="span__fonte">
        <a href="https://github.com/jayp-xgh/my_articles_jayp">
            font
        </a>
    </span>
</footer>
</body>
</html>